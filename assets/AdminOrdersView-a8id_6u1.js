import{C as x}from"./CardPagination-ZXptYOdk.js";import{L as C}from"./index-T4iu_HKs.js";import{h as B}from"./moment-WSJ9un1t.js";import{_ as O,r as p,o as n,c as o,a as t,v as L,x as S,u as r,e as u,s as I,t as T,F as _,q as m,b as g,w as f}from"./index-AmqyvTUw.js";var V={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"ahmomoz",BASE_URL:"/vue-final/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:y,VITE_APIPATH:v}=V,A={data(){return{sortBy:"default",ascending:!0,allOrders:[],orders:[],searchInput:"",pagination:{},isLoading:!0}},methods:{getOrderList(d=1){this.isLoading=!0,this.$axios.get(`${y}/api/${v}/admin/orders?page=${d}`).then(s=>{const{orders:a,pagination:h}=s.data;this.allOrders=a,this.orders=a,this.pagination=h}).catch(s=>{this.$Swal.fire({icon:"error",title:s.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteOrder(d,s){this.$Swal.fire({title:"即將刪除訂單",text:`確定要刪除「${d}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#eb5a68",cancelButtonColor:"#8bafd7",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(a=>{a.isConfirmed&&this.$axios.delete(`${y}/api/${v}/admin/order/${s}`).then(h=>{this.$Swal.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:700}),this.getOrderList()}).catch(h=>{this.$Swal.fire({icon:"error",title:h.response.data.message})})})},orderSearch(){this.orders=this.ordersFilteredResults},formatDateString(d){return B(d).format("YYYY-MM-DD HH:mm:ss")}},computed:{sortOrders(){return[...this.orders].sort((s,a)=>this.ascending?s[this.sortBy]-a[this.sortBy]:a[this.sortBy]-s[this.sortBy])},ordersFilteredResults(){return this.allOrders.filter(s=>String(s.create_at).toLowerCase().includes(this.searchInput.toLowerCase()))}},mounted(){this.getOrderList()},components:{CardPagination:x,Loading:C}},D={id:"app"},E={class:"card mt-lg-3 shadow-sm"},P={class:"navbar navbar-light bg-light"},R={class:"container-fluid"},N={class:"row g-2 align-items-center"},q={class:"col-auto"},F={class:"col-auto"},H={class:"card my-1 my-lg-4 shadow-sm"},M={class:"card-header"},U={class:"text-end py-2"},Y={class:"card-body"},G={class:"table table-hover"},$={class:"bg-light"},j={class:"align-middle"},z=t("span",{class:"bi bi-arrow-down-up ms-1"},null,-1),J=t("th",null,"訂購者",-1),K=t("th",null,"訂購商品",-1),Q=t("span",{class:"bi bi-arrow-down-up ms-1"},null,-1),W=t("th",null,"狀態",-1),X=t("th",null,"訂單成立時間",-1),Z=t("th",null,"操作",-1),tt={key:0},et=t("br",null,null,-1),st={key:0,class:"text-primary"},nt={key:1},ot={class:"btn-group"},it=["onClick"],rt={key:1},at=t("br",null,null,-1),lt={key:0,class:"text-primary"},dt={key:1},ct={class:"btn-group"},ut=["onClick"],_t={class:"card-footer d-flex justify-content-center"};function ht(d,s,a,h,i,c){const k=p("loading"),b=p("router-link"),w=p("card-pagination");return n(),o("div",D,[t("div",E,[t("nav",P,[t("div",R,[t("form",N,[t("div",q,[L(t("input",{class:"form-control",type:"search",placeholder:"搜尋訂單編號","aria-label":"Search","onUpdate:modelValue":s[0]||(s[0]=e=>i.searchInput=e)},null,512),[[S,i.searchInput]])]),t("div",F,[t("button",{class:"btn btn-outline-primary",type:"button",onClick:s[1]||(s[1]=(...e)=>c.orderSearch&&c.orderSearch(...e))},"搜尋 ")])])])])]),t("div",H,[t("div",M,[t("div",U,[t("button",{type:"button",class:"btn btn-primary text-white",onClick:s[2]||(s[2]=e=>i.ascending=!i.ascending)},r(i.ascending?"降冪":"升冪")+"排序 ",1)])]),t("div",Y,[t("table",G,[t("thead",$,[t("tr",j,[t("th",{onClick:s[3]||(s[3]=e=>i.sortBy="create_at")},[u("訂單編號 "),z]),J,K,t("th",{onClick:s[4]||(s[4]=e=>i.sortBy="total")},[u(" 金額 "),Q]),W,X,Z])]),i.sortBy==="default"?(n(),o("tbody",tt,[i.isLoading?(n(),I(k,{key:0,active:i.isLoading,"can-cancel":!1},null,8,["active"])):T("",!0),(n(!0),o(_,null,m(i.orders,e=>(n(),o("tr",{key:e.id},[t("td",null,r(e.create_at),1),t("td",null,r(e.user.name),1),t("td",null,[(n(!0),o(_,null,m(e.products,l=>(n(),o(_,{key:l.id},[u(r(l.product.title)+" x"+r(l.qty),1),et],64))),128))]),t("td",null," NT$"+r(e.total),1),t("td",null,[e.is_paid?(n(),o("span",st,"已付款")):(n(),o("span",nt,"未付款"))]),t("td",null,r(c.formatDateString(e.user.date)),1),t("td",null,[t("div",ot,[g(b,{class:"btn btn-outline-primary btn-sm",to:{name:"訂單詳細頁面",params:{id:e.id},query:{currentPage:i.pagination.current_page}}},{default:f(()=>[u(" 詳細 ")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.deleteOrder(e.create_at,e.id)}," 刪除 ",8,it)])])]))),128))])):(n(),o("tbody",rt,[(n(!0),o(_,null,m(c.sortOrders,e=>(n(),o("tr",{key:e.id},[t("td",null,r(e.create_at),1),t("td",null,r(e.user.name),1),t("td",null,[(n(!0),o(_,null,m(e.products,l=>(n(),o(_,{key:l.id},[u(r(l.product.title)+" x"+r(l.qty),1),at],64))),128))]),t("td",null," NT$"+r(e.total),1),t("td",null,[e.is_paid?(n(),o("span",lt,"已付款")):(n(),o("span",dt,"未付款"))]),t("td",null,r(c.formatDateString(e.user.date)),1),t("td",null,[t("div",ct,[g(b,{class:"btn btn-outline-primary btn-sm",to:{name:"訂單詳細頁面",params:{id:e.id},query:{currentPage:i.pagination.current_page}}},{default:f(()=>[u(" 詳細 ")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.deleteOrder(e.create_at,e.id)}," 刪除 ",8,ut)])])]))),128))]))])]),t("div",_t,[g(w,{pagination:i.pagination,onEmitGetlist:c.getOrderList},null,8,["pagination","onEmitGetlist"])])])])}const ft=O(A,[["render",ht]]);export{ft as default};
