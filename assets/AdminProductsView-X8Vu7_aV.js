import{_ as p,o as i,c as a,a as t,n as g,k as b,F as h,e as y,t as u,m as M,l as k,h as C,b as P,r as m}from"./index-idJGLwFX.js";import{L as x}from"./index-DZ48J2Au.js";const L={props:["pagination"],methods:{getProductsList(o){this.$emit("emit-getproductslist",o)}}},U={"aria-label":"Page navigation example"},w={class:"pagination"},B=t("span",{"aria-hidden":"true"},"«",-1),D=[B],I=["onClick"],G=t("span",{"aria-hidden":"true"},"»",-1),N=[G];function V(o,e,s,r,l,n){return i(),a("nav",U,[t("ul",w,[t("li",{class:g(["page-item",{disabled:s.pagination.current_page===1}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=b(c=>n.getProductsList(s.pagination.current_page-1),["prevent"]))},D)],2),(i(!0),a(h,null,y(s.pagination.total_pages,c=>(i(),a("li",{class:"page-item",key:c},[t("a",{class:g(["page-link",{active:s.pagination.current_page===c}]),href:"#",onClick:b(f=>n.getProductsList(c),["prevent"])},u(c),11,I)]))),128)),t("li",{class:g(["page-item",{disabled:s.pagination.current_page===s.pagination.total_pages}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=b(c=>n.getProductsList(s.pagination.current_page+1),["prevent"]))},N)],2)])])}const z=p(L,[["render",V]]),H={props:["item"],data(){return{url:"https://ec-course-api.hexschool.io/v2",path:"ahmomoz"}},methods:{updateProduct(){const o=this.item;let e=`${this.url}/api/${this.path}/admin/product`,s="post";o.id&&(e=`${this.url}/api/${this.path}/admin/product/${o.id}`,s="put"),this.$axios[s](e,{data:o}).then(r=>{alert("更新成功"),this.$emit("hide-modal"),this.$emit("get-products-list")}).catch(r=>{alert(r.response.data.message)})},deleteImg(o){this.$emit("delete-img",o)},imgUpload(o){const e=o.target.files[0],s=new FormData;s.append("file-to-upload",e),this.$axios.post(`${this.url}/api/${this.path}/admin/upload`,s).then(r=>{const l=r.data.imageUrl;this.$emit("img-url-update",l)}).catch(r=>{alert(r.response.data.message)})}},mounted(){}},A={id:"productModal",ref:"productModal",class:"modal hide",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},E={class:"modal-dialog modal-xl"},F={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},j={id:"productModalLabel",class:"modal-title"},q={key:0},J={key:1},K=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-footer"},Q=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function R(o,e,s,r,l,n){return i(),a("div",A,[t("div",E,[t("div",F,[t("div",S,[t("h5",j,[s.item.id?(i(),a("span",J,"編輯產品")):(i(),a("span",q,"新增產品"))]),K]),t("div",O,[Q,t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=(...c)=>n.updateProduct&&n.updateProduct(...c))}," 確認 ")])])])],512)}const T=p(H,[["render",R]]),W={props:["item"],data(){return{url:"https://ec-course-api.hexschool.io/v2",path:"ahmomoz"}},methods:{deleteProduct(){const o=this.item;this.$axios.delete(`${this.url}/api/${this.path}/admin/product/${o.id}`).then(e=>{alert("商品刪除成功"),this.$emit("hide-delete-modal"),this.$emit("get-products-list")}).catch(e=>{alert(e.response.data.message)})}},mounted(){}},X={id:"delProductModal",ref:"delProductModal",class:"modal hide",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Y={class:"modal-dialog"},Z={class:"modal-content border-0"},tt=M('<div class="modal-header bg-danger text-white"><h5 id="delProductModalLabel" class="modal-title"><span>刪除產品</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"> 是否刪除 <strong class="text-danger"></strong>(刪除後將無法恢復)。 </div>',2),et={class:"modal-footer"},ot=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function st(o,e,s,r,l,n){return i(),a("div",X,[t("div",Y,[t("div",Z,[tt,t("div",et,[ot,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...c)=>n.deleteProduct&&n.deleteProduct(...c))}," 確認刪除 ")])])])],512)}const nt=p(W,[["render",st]]),dt={data(){return{sortBy:"default",ascending:!0,products:[],productsDetail:{},tempProduct:{imagesUrl:[]},pagination:{},isLoading:!0,modal:{productModal:"",delProductModal:""}}},methods:{getProductsList(o=1){this.isLoading=!0,this.$axios.get(`https://vue3-course-api.hexschool.io/v2/api/ahmomoz/admin/products?page=${o}`).then(e=>{const{products:s,pagination:r}=e.data;this.products=s,this.pagination=r}).catch(e=>{alert(e.response.data.message)}).finally(()=>{this.isLoading=!1})},openProductModal(o,e){o&&e==="del"?(this.tempProduct={...o},this.$refs.delProductModal.openModal()):o&&e==="edit"?(this.tempProduct={...o},this.$refs.productModal.openModal()):(this.tempProduct={imagesUrl:[""]},this.$refs.productModal.openModal())},deleteImg(o){this.tempProduct.imagesUrl=[""]},imgUrlUpdate(o){this.tempProduct.imagesUrl[0]===""?this.tempProduct.imagesUrl[0]=o:this.tempProduct.imagesUrl.push(o)},hideModal(){this.$refs.productModal.hideModal()},hideDeleteModal(){this.$refs.delModal.hideModal()}},computed:{sortProducts(){return[...this.products].sort((e,s)=>this.ascending?e[this.sortBy]-s[this.sortBy]:s[this.sortBy]-e[this.sortBy])}},mounted(){this.getProductsList(),console.log(this.$refs)},components:{CardPagination:z,AdminCardProductModel:T,AdminCardDeleteModel:nt,Loading:x}},it={id:"app"},at={class:"card my-1 my-lg-4 shadow-sm"},lt={class:"card-header"},rt={class:"text-end"},ct={class:"card-body"},ut={class:"table table-hover"},mt={class:"bg-light"},ht={class:"align-middle"},pt=t("th",{width:"120"},"分類",-1),_t=t("th",null,"產品名稱",-1),gt=t("th",{width:"100"},"是否啟用",-1),bt=t("th",{width:"120"},"編輯",-1),Pt={key:0},yt={key:0,class:"text-success"},ft={key:1},vt={class:"btn-group"},$t=["onClick"],Mt=["onClick"],kt={key:1},Ct={key:0,class:"text-success"},xt={key:1},Lt={class:"btn-group"},Ut=["onClick"],wt=["onClick"],Bt={class:"card-footer"};function Dt(o,e,s,r,l,n){const c=m("loading"),f=m("card-pagination"),v=m("admin-card-product-model"),$=m("admin-card-delete-model");return i(),a(h,null,[t("div",it,[t("div",at,[t("div",lt,[t("div",rt,[t("button",{type:"button",class:"btn btn-info text-white mx-3",onClick:e[0]||(e[0]=d=>l.ascending=!l.ascending)},u(l.ascending?"降冪":"升冪")+"排序 ",1),t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=d=>n.openProductModal(""))}," 建立新的產品 ")])]),t("div",ct,[t("table",ut,[t("thead",mt,[t("tr",ht,[pt,_t,t("th",{width:"120",onClick:e[2]||(e[2]=d=>l.sortBy="origin_price")},"原價"),t("th",{width:"120",onClick:e[3]||(e[3]=d=>l.sortBy="price")},"售價"),gt,bt])]),l.sortBy==="default"?(i(),a("tbody",Pt,[l.isLoading?(i(),k(c,{key:0,active:l.isLoading,"can-cancel":!1},null,8,["active"])):C("",!0),(i(!0),a(h,null,y(l.products,d=>(i(),a("tr",{key:d.id},[t("td",null,u(d.category),1),t("td",null,u(d.title),1),t("td",null,u(d.origin_price),1),t("td",null,u(d.price),1),t("td",null,[d.is_enabled?(i(),a("span",yt,"啟用")):(i(),a("span",ft,"未啟用"))]),t("td",null,[t("div",vt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>n.openProductModal(d,"edit")}," 編輯 ",8,$t),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>n.openProductModal(d,"del")}," 刪除 ",8,Mt)])])]))),128))])):(i(),a("tbody",kt,[(i(!0),a(h,null,y(n.sortProducts,d=>(i(),a("tr",{key:d.name},[t("td",null,u(d.category),1),t("td",null,u(d.title),1),t("td",null,u(d.origin_price),1),t("td",null,u(d.price),1),t("td",null,[d.is_enabled?(i(),a("span",Ct,"啟用")):(i(),a("span",xt,"未啟用"))]),t("td",null,[t("div",Lt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>n.openProductModal(d,"edit")}," 編輯 ",8,Ut),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>n.openProductModal(d,"del")}," 刪除 ",8,wt)])])]))),128))]))])]),t("div",Bt,[P(f,{pagination:l.pagination,onEmitGetproductslist:n.getProductsList},null,8,["pagination","onEmitGetproductslist"])])])]),P(v,{item:l.tempProduct,onHideModal:n.hideModal,onGetProductsList:n.getProductsList,onDeleteImg:n.deleteImg,onImgUrlUpdate:n.imgUrlUpdate,ref:"productModal"},null,8,["item","onHideModal","onGetProductsList","onDeleteImg","onImgUrlUpdate"]),P($,{item:l.tempProduct,onHideDeleteModal:n.hideDeleteModal,onGetProductsList:n.getProductsList,ref:"delProductModal"},null,8,["item","onHideDeleteModal","onGetProductsList"])],64)}const Nt=p(dt,[["render",Dt]]);export{Nt as default};
