import{u as l,x as r,S as a,J as h}from"./index-IkRGDjhC.js";import{L as f}from"./index-v_09iHwz.js";var u={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"ahmomoz",BASE_URL:"/vue-final/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:o,VITE_APIPATH:n}=u,g=l("cartStore",{state:()=>({cart:[],final_total:0,total:0,cartList:{},cartListTotalQty:"",isLoading:!0,form:{user:{email:"",name:"",tel:"",address:"",date:""},message:""},orderID:""}),actions:{getCartList(){this.isLoading=!0,r.get(`${o}/api/${n}/cart`).then(t=>{this.cart=t.data.data.cart,this.final_total=t.data.data.final_total,this.total=t.data.data.total,this.cartList=t.data.data.carts,this.cartListTotalQty=t.data.data.carts.reduce((e,i)=>e+i.qty,0)}).catch(t=>{a.fire({icon:"error",title:t})}).finally(()=>{this.isLoading=!1})},addToCart(t,e){return new Promise((i,c)=>{this.isLoading=!0;const s={data:{product_id:t.id,qty:e}};r.post(`${o}/api/${n}/cart`,s).then(d=>{a.fire({position:"top-end",icon:"success",title:"成功加入購物車",showConfirmButton:!1,timer:700}),this.getCartList(),i()}).catch(d=>{a.fire({icon:"error",title:d.response}),c(d)}).finally(()=>{this.isLoading=!1})})},useCoupon(t){this.isLoading=!0;const e={data:{code:t}};r.post(`${o}/api/${n}/coupon`,e).then(i=>{this.getCartList()}).catch(i=>{a.fire({icon:"error",title:i.response.data.message})}).finally(()=>{this.isLoading=!1})},updateQty(t,e){this.isLoading=!0;const i=parseInt(e.target.value,10),c={data:{product_id:t.id,qty:i}};r.put(`${o}/api/${n}/cart/${t.id}`,c).then(s=>{this.getCartList()}).catch(s=>{a.fire({icon:"error",title:s.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteProduct(t){this.isLoading=!0,r.delete(`${o}/api/${n}/cart/${t.id}`).then(e=>{a.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:700}),this.getCartList()}).catch(e=>{a.fire({icon:"error",title:e.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteCart(){a.fire({title:"確定要清空購物車嗎？",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(t=>{t.isConfirmed&&(this.isLoading=!0,r.delete(`${o}/api/${n}/carts`).then(e=>{a.fire({title:"已清空購物車",icon:"success"}),this.getCartList()}).catch(e=>{a.fire({icon:"error",title:e.response.data.message})}).finally(()=>{this.isLoading=!1}))})},addOrder(t){const i=new Date().toISOString();t.user.date=i;const c=t;this.isLoading=!0,r.post(`${o}/api/${n}/order`,{data:c}).then(s=>{this.form={user:{email:"",name:"",tel:"",address:""},message:""},this.orderID=s.data.orderId,h.push(`/checkout/${this.orderID}`)}).catch(s=>{a.fire({icon:"error",title:s.response.data.message})}).finally(()=>{this.isLoading=!1})}},components:{Loading:f}});export{g as c};
