import{u as d,x as s,S as a,J as l}from"./index-7P-JXuOL.js";import{L as h}from"./index-NLQl2SVD.js";var f={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"ahmomoz",BASE_URL:"/vue-final/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:r,VITE_APIPATH:o}=f,p=d("cartStore",{state:()=>({cart:[],final_total:0,total:0,cartList:{},cartListTotalQty:"",isLoading:!0,form:{user:{email:"",name:"",tel:"",address:"",date:""},message:""},orderID:""}),actions:{getCartList(){this.isLoading=!0,s.get(`${r}/api/${o}/cart`).then(t=>{this.cart=t.data.data.cart,this.final_total=t.data.data.final_total,this.total=t.data.data.total,this.cartList=t.data.data.carts,this.cartListTotalQty=t.data.data.carts.reduce((e,i)=>e+i.qty,0)}).catch(t=>{a.fire({icon:"error",title:t})}).finally(()=>{this.isLoading=!1})},addToCart(t,e){this.isLoading=!0;const i={data:{product_id:t.id,qty:e}};s.post(`${r}/api/${o}/cart`,i).then(n=>{a.fire({position:"top-end",icon:"success",title:"成功加入購物車",showConfirmButton:!1,timer:700}),this.getCartList()}).catch(n=>{a.fire({icon:"error",title:n.response})}).finally(()=>{this.isLoading=!1})},useCoupon(t){this.isLoading=!0;const e={data:{code:t}};s.post(`${r}/api/${o}/coupon`,e).then(i=>{this.getCartList()}).catch(i=>{a.fire({icon:"error",title:i.response.data.message})}).finally(()=>{this.isLoading=!1})},updateQty(t,e){this.isLoading=!0;const i=parseInt(e.target.value,10),n={data:{product_id:t.id,qty:i}};s.put(`${r}/api/${o}/cart/${t.id}`,n).then(c=>{this.getCartList()}).catch(c=>{a.fire({icon:"error",title:c.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteProduct(t){this.isLoading=!0,s.delete(`${r}/api/${o}/cart/${t.id}`).then(e=>{a.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:700}),this.getCartList()}).catch(e=>{a.fire({icon:"error",title:e.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteCart(){a.fire({title:"確定要清空購物車嗎？",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(t=>{t.isConfirmed&&(this.isLoading=!0,s.delete(`${r}/api/${o}/carts`).then(e=>{a.fire({title:"已清空購物車",icon:"success"}),this.getCartList()}).catch(e=>{a.fire({icon:"error",title:e.response.data.message})}).finally(()=>{this.isLoading=!1}))})},addOrder(t){const i=new Date().toISOString();t.user.date=i;const n=t;this.isLoading=!0,s.post(`${r}/api/${o}/order`,{data:n}).then(c=>{this.form={user:{email:"",name:"",tel:"",address:""},message:""},this.orderID=c.data.orderId,l.push(`/checkout/${this.orderID}`)}).catch(c=>{a.fire({icon:"error",title:c.response.data.message})}).finally(()=>{this.isLoading=!1})}},components:{Loading:h}});export{p as c};
