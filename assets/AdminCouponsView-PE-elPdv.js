import{C as v}from"./CardPagination-oRhu18MB.js";import{L as B}from"./index-6GzzhNGI.js";import{h as x}from"./moment-WSJ9un1t.js";import{_ as L,r as _,o as a,c as r,b as t,d as u,w as p,g as k,h as m,F as w,i as E,f as g,t as c}from"./index-sE0cGx2q.js";var S={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"ahmomoz",BASE_URL:"/vue-final/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:f,VITE_APIPATH:y}=S,V={data(){return{sortBy:"default",ascending:!0,allCoupons:[],coupons:[],pagination:{},isLoading:!0}},methods:{getCouponList(n=1){this.isLoading=!0,this.$axios.get(`${f}/api/${y}/admin/coupons?page=${n}`).then(e=>{const{coupons:o,pagination:l}=e.data;this.allCoupons=o,this.coupons=o,this.pagination=l}).catch(e=>{this.$Swal.fire({icon:"error",title:e.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteCoupon(n,e){this.$Swal.fire({title:"即將刪除優惠券",text:`確定要刪除「${n}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#eb5a68",cancelButtonColor:"#8bafd7",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(o=>{o.isConfirmed&&this.$axios.delete(`${f}/api/${y}/admin/coupon/${e}`).then(l=>{this.$Swal.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:700}),this.getCouponList()}).catch(l=>{this.$Swal.fire({icon:"error",title:l.response.data.message})})})},formatDateString(n){return x.unix(n).format("YYYY-MM-DD HH:mm:ss")}},computed:{sortOrders(){return[...this.orders].sort((e,o)=>this.ascending?e[this.sortBy]-o[this.sortBy]:o[this.sortBy]-e[this.sortBy])}},mounted(){this.getCouponList()},components:{CardPagination:v,Loading:B}},P={id:"app"},T={class:"card my-1 my-lg-4 shadow-sm"},$={class:"card-header"},A={class:"text-end py-2"},D=t("span",{class:"bi bi-plus"},null,-1),I={class:"card-body"},O={class:"table table-hover"},R={class:"bg-light"},H={class:"align-middle"},N=t("th",null,"名稱",-1),Y=t("th",null,"折扣數",-1),M=t("th",null,"狀態",-1),U=t("th",null,"到期時間",-1),F=t("th",null,"操作",-1),G={key:0},j={key:0,class:"text-primary"},q={key:1},z={class:"btn-group"},J=["onClick"],K={class:"card-footer d-flex justify-content-center"};function Q(n,e,o,l,i,d){const h=_("router-link"),b=_("loading"),C=_("card-pagination");return a(),r("div",P,[t("div",T,[t("div",$,[t("div",A,[u(h,{class:"btn btn-primary text-light ms-2",to:"coupon/add"},{default:p(()=>[D,g(" 建立優惠券 ")]),_:1})])]),t("div",I,[t("table",O,[t("thead",R,[t("tr",H,[t("th",{onClick:e[0]||(e[0]=s=>i.sortBy="create_at")},"折扣碼"),N,Y,M,U,F])]),i.sortBy==="default"?(a(),r("tbody",G,[i.isLoading?(a(),k(b,{key:0,active:i.isLoading,"can-cancel":!1},null,8,["active"])):m("",!0),(a(!0),r(w,null,E(i.coupons,s=>(a(),r("tr",{key:s.id},[t("td",null,c(s.code),1),t("td",null,c(s.title),1),t("td",null,c(100-s.percent)+"%",1),t("td",null,[s.is_enabled?(a(),r("span",j,"已啟用")):(a(),r("span",q,"未啟用"))]),t("td",null,c(d.formatDateString(s.due_date)),1),t("td",null,[t("div",z,[u(h,{class:"btn btn-outline-primary btn-sm",to:{name:"優惠券單一編輯頁面",params:{id:s.id},query:{currentPage:i.pagination.current_page}}},{default:p(()=>[g("詳細")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:W=>d.deleteCoupon(s.title,s.id)}," 刪除 ",8,J)])])]))),128))])):m("",!0)])]),t("div",K,[u(C,{pagination:i.pagination,onEmitGetlist:d.getCouponList},null,8,["pagination","onEmitGetlist"])])])])}const st=L(V,[["render",Q]]);export{st as default};
