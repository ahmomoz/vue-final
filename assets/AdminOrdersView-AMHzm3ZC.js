import{C as w}from"./CardPagination-b_uqQSNH.js";import{L as k}from"./index-RIvZXr4n.js";import{h as x}from"./moment-WSJ9un1t.js";import{_ as C,c as o,a as t,j as B,v as L,t as a,d as u,m as O,i as S,F as h,h as m,b as p,r as g,o as n,w as y}from"./index-CEKiAcMy.js";const V={data(){return{sortBy:"default",ascending:!0,allOrders:[],orders:[],searchInput:"",pagination:{},isLoading:!0}},methods:{getOrderList(d=1){this.isLoading=!0,this.$axios.get(`https://vue3-course-api.hexschool.io/v2/api/ahmomoz/admin/orders?page=${d}`).then(s=>{const{orders:r,pagination:_}=s.data;this.allOrders=r,this.orders=r,this.pagination=_}).catch(s=>{this.$Swal.fire({icon:"error",title:s.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteOrder(d,s){this.$Swal.fire({title:"即將刪除訂單",text:`確定要刪除「${d}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#eb5a68",cancelButtonColor:"#8bafd7",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(r=>{r.isConfirmed&&this.$axios.delete(`https://vue3-course-api.hexschool.io/v2/api/ahmomoz/admin/order/${s}`).then(_=>{this.$Swal.fire({title:"已刪除",icon:"success"}),this.getOrderList()}).catch(_=>{this.$Swal.fire({icon:"error",title:_.response.data.message})})})},orderSearch(){this.orders=this.ordersFilteredResults},formatDateString(d){return x(d).format("YYYY-MM-DD HH:mm:ss")}},computed:{sortOrders(){return[...this.orders].sort((s,r)=>this.ascending?s[this.sortBy]-r[this.sortBy]:r[this.sortBy]-s[this.sortBy])},ordersFilteredResults(){return this.allOrders.filter(s=>String(s.create_at).toLowerCase().includes(this.searchInput.toLowerCase()))}},mounted(){this.getOrderList()},components:{CardPagination:w,Loading:k}},D={id:"app"},N={class:"card mt-lg-3 shadow-sm"},T={class:"navbar navbar-light bg-light"},M={class:"container-fluid"},q={class:"row g-2 align-items-center"},F={class:"col-auto"},I={class:"col-auto"},Y={class:"card my-1 my-lg-4 shadow-sm"},A={class:"card-header"},E={class:"text-end"},P={class:"card-body"},j={class:"table table-hover"},z={class:"bg-light"},G={class:"align-middle"},H=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-up ms-1",viewBox:"0 0 16 16"},[t("path",{"fill-rule":"evenodd",d:"M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5m-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5"})],-1),R=t("th",null,"訂購者",-1),$=t("th",null,"訂購商品",-1),U=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-up ms-1",viewBox:"0 0 16 16"},[t("path",{"fill-rule":"evenodd",d:"M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5m-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5"})],-1),J=t("th",null,"狀態",-1),K=t("th",null,"訂單成立時間",-1),Q=t("th",null,"操作",-1),W={key:0},X=t("br",null,null,-1),Z={key:0,class:"text-primary"},tt={key:1},et={class:"btn-group"},st=["onClick"],nt={key:1},ot=t("br",null,null,-1),it={key:0,class:"text-primary"},at={key:1},rt={class:"btn-group"},lt=["onClick"],dt={class:"card-footer d-flex justify-content-center"};function ct(d,s,r,_,i,c){const v=g("loading"),b=g("router-link"),f=g("card-pagination");return n(),o("div",D,[t("div",N,[t("nav",T,[t("div",M,[t("form",q,[t("div",F,[B(t("input",{class:"form-control",type:"search",placeholder:"搜尋訂單編號","aria-label":"Search","onUpdate:modelValue":s[0]||(s[0]=e=>i.searchInput=e)},null,512),[[L,i.searchInput]])]),t("div",I,[t("button",{class:"btn btn-outline-primary",type:"submit",onClick:s[1]||(s[1]=(...e)=>c.orderSearch&&c.orderSearch(...e))},"搜尋")])])])])]),t("div",Y,[t("div",A,[t("div",E,[t("button",{type:"button",class:"btn btn-primary text-white",onClick:s[2]||(s[2]=e=>i.ascending=!i.ascending)},a(i.ascending?"降冪":"升冪")+"排序 ",1)])]),t("div",P,[t("table",j,[t("thead",z,[t("tr",G,[t("th",{onClick:s[3]||(s[3]=e=>i.sortBy="create_at")},[u("訂單編號 "),H]),R,$,t("th",{onClick:s[4]||(s[4]=e=>i.sortBy="total")},[u(" 金額 "),U]),J,K,Q])]),i.sortBy==="default"?(n(),o("tbody",W,[i.isLoading?(n(),O(v,{key:0,active:i.isLoading,"can-cancel":!1},null,8,["active"])):S("",!0),(n(!0),o(h,null,m(i.orders,e=>(n(),o("tr",{key:e.id},[t("td",null,a(e.create_at),1),t("td",null,a(e.user.name),1),t("td",null,[(n(!0),o(h,null,m(e.products,l=>(n(),o(h,{key:l.id},[u(a(l.product.title)+" x"+a(l.qty),1),X],64))),128))]),t("td",null," NT$"+a(e.total),1),t("td",null,[e.is_paid?(n(),o("span",Z,"已付款")):(n(),o("span",tt,"未付款"))]),t("td",null,a(c.formatDateString(e.user.date)),1),t("td",null,[t("div",et,[p(b,{class:"btn btn-outline-primary btn-sm",to:{name:"訂單詳細頁面",params:{id:e.id},query:{currentPage:i.pagination.current_page}}},{default:y(()=>[u("詳細")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.deleteOrder(e.create_at,e.id)}," 刪除 ",8,st)])])]))),128))])):(n(),o("tbody",nt,[(n(!0),o(h,null,m(c.sortOrders,e=>(n(),o("tr",{key:e.id},[t("td",null,a(e.create_at),1),t("td",null,a(e.user.name),1),t("td",null,[(n(!0),o(h,null,m(e.products,l=>(n(),o(h,{key:l.id},[u(a(l.product.title)+" x"+a(l.qty),1),ot],64))),128))]),t("td",null," NT$"+a(e.total),1),t("td",null,[e.is_paid?(n(),o("span",it,"已付款")):(n(),o("span",at,"未付款"))]),t("td",null,a(c.formatDateString(e.user.date)),1),t("td",null,[t("div",rt,[p(b,{class:"btn btn-outline-primary btn-sm",to:{name:"訂單詳細頁面",params:{id:e.id},query:{currentPage:i.pagination.current_page}}},{default:y(()=>[u("詳細")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.deleteOrder(e.create_at,e.id)}," 刪除 ",8,lt)])])]))),128))]))])]),t("div",dt,[p(f,{pagination:i.pagination,onEmitGetlist:c.getOrderList},null,8,["pagination","onEmitGetlist"])])])])}const pt=C(V,[["render",ct]]);export{pt as default};
