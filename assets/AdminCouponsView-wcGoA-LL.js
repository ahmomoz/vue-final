import{C as w}from"./CardPagination-b_uqQSNH.js";import{L as C}from"./index-RIvZXr4n.js";import{h as k}from"./moment-WSJ9un1t.js";import{_ as x,c as o,a as t,t as i,b as _,w as g,m as B,i as L,F as p,h as b,d as h,r as f,o as s}from"./index-CEKiAcMy.js";const S={data(){return{sortBy:"default",ascending:!0,allCoupons:[],coupons:[],pagination:{},isLoading:!0}},methods:{getCouponList(l=1){this.isLoading=!0,this.$axios.get(`https://vue3-course-api.hexschool.io/v2/api/ahmomoz/admin/coupons?page=${l}`).then(n=>{const{coupons:r,pagination:d}=n.data;this.allCoupons=r,this.coupons=r,this.pagination=d,console.log(this.coupons)}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteCoupon(l,n){this.$Swal.fire({title:"即將刪除優惠券",text:`確定要刪除「${l}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#eb5a68",cancelButtonColor:"#8bafd7",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(r=>{r.isConfirmed&&this.$axios.delete(`https://vue3-course-api.hexschool.io/v2/api/ahmomoz/admin/coupon/${n}`).then(d=>{this.$Swal.fire({title:"已刪除",icon:"success"}),this.getCouponList()}).catch(d=>{this.$Swal.fire({icon:"error",title:d.response.data.message})})})},formatDateString(l){return k.unix(l).format("YYYY-MM-DD HH:mm:ss")}},computed:{sortOrders(){return[...this.orders].sort((n,r)=>this.ascending?n[this.sortBy]-r[this.sortBy]:r[this.sortBy]-n[this.sortBy])}},mounted(){this.getCouponList()},components:{CardPagination:w,Loading:C}},V={id:"app"},$={class:"card my-1 my-lg-4 shadow-sm"},D={class:"card-header"},N={class:"text-end"},O=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus",viewBox:"4 4 12 12"},[t("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),M={class:"card-body"},P={class:"table table-hover"},T={class:"bg-light"},Y={class:"align-middle"},E=t("th",null,"名稱",-1),q=t("th",null,"折扣數",-1),z=t("th",null,"狀態",-1),A=t("th",null,[h("最後更新時間"),t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-down-up ms-1",viewBox:"0 0 16 16"},[t("path",{"fill-rule":"evenodd",d:"M11.5 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L11 2.707V14.5a.5.5 0 0 0 .5.5m-7-14a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L4 13.293V1.5a.5.5 0 0 1 .5-.5"})])],-1),F=t("th",null,"操作",-1),G={key:0},H={key:0,class:"text-primary"},j={key:1},I={class:"btn-group"},J=["onClick"],K={key:1},Q=t("br",null,null,-1),R={key:0,class:"text-primary"},U={key:1},W={class:"btn-group"},X=["onClick"],Z={class:"card-footer d-flex justify-content-center"};function tt(l,n,r,d,a,c){const m=f("router-link"),y=f("loading"),v=f("card-pagination");return s(),o("div",V,[t("div",$,[t("div",D,[t("div",N,[t("button",{type:"button",class:"btn btn-primary text-white",onClick:n[0]||(n[0]=e=>a.ascending=!a.ascending)},i(a.ascending?"降冪":"升冪")+"排序 ",1),_(m,{class:"btn btn-primary text-light ms-2",to:"coupon/add"},{default:g(()=>[O,h(" 建立優惠券 ")]),_:1})])]),t("div",M,[t("table",P,[t("thead",T,[t("tr",Y,[t("th",{onClick:n[1]||(n[1]=e=>a.sortBy="create_at")},"折扣碼"),E,q,z,A,F])]),a.sortBy==="default"?(s(),o("tbody",G,[a.isLoading?(s(),B(y,{key:0,active:a.isLoading,"can-cancel":!1},null,8,["active"])):L("",!0),(s(!0),o(p,null,b(a.coupons,e=>(s(),o("tr",{key:e.id},[t("td",null,i(e.code),1),t("td",null,i(e.title),1),t("td",null,i(e.percent)+"%",1),t("td",null,[e.is_enabled?(s(),o("span",H,"已啟用")):(s(),o("span",j,"未啟用"))]),t("td",null,i(c.formatDateString(e.due_date)),1),t("td",null,[t("div",I,[_(m,{class:"btn btn-outline-primary btn-sm",to:{name:"優惠券單一編輯頁面",params:{id:e.id},query:{currentPage:a.pagination.current_page}}},{default:g(()=>[h("詳細")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>c.deleteCoupon(e.title,e.id)}," 刪除 ",8,J)])])]))),128))])):(s(),o("tbody",K,[(s(!0),o(p,null,b(c.sortOrders,e=>(s(),o("tr",{key:e.id},[t("td",null,i(e.create_at),1),t("td",null,i(e.user.name),1),t("td",null,[(s(!0),o(p,null,b(e.products,u=>(s(),o(p,{key:u.id},[h(i(u.product.title)+" x"+i(u.qty),1),Q],64))),128))]),t("td",null," NT$"+i(e.total),1),t("td",null,[e.is_paid?(s(),o("span",R,"已付款")):(s(),o("span",U,"未付款"))]),t("td",null,i(c.formatDateString(e.user.date)),1),t("td",null,[t("div",W,[_(m,{class:"btn btn-outline-primary btn-sm",to:{name:"order-details",params:{id:e.id,currentPage:l.$route.fullPath}}},{default:g(()=>[h("詳細")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>l.deleteOrder(e.create_at,e.id)}," 刪除 ",8,X)])])]))),128))]))])]),t("div",Z,[_(v,{pagination:a.pagination,onEmitGetlist:c.getCouponList},null,8,["pagination","onEmitGetlist"])])])])}const it=x(S,[["render",tt]]);export{it as default};
