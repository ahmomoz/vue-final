import{C}from"./CardPagination-nc8uS4J2.js";import{L as x}from"./index-T6W-CKt5.js";import{h as B}from"./moment-WSJ9un1t.js";import{_ as O,r as p,o as n,c as o,b as t,k as L,v as S,t as r,f as u,g as P,h as I,F as _,i as m,d as g,w as b}from"./index-OK89IDBn.js";var T={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"ahmomoz",BASE_URL:"/vue-final/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:y,VITE_APIPATH:v}=T,V={data(){return{sortBy:"default",ascending:!0,allOrders:[],orders:[],searchInput:"",pagination:{},isLoading:!0}},methods:{getOrderList(a=1){this.isLoading=!0,this.$axios.get(`${y}/api/${v}/admin/orders?page=${a}`).then(s=>{const{orders:l,pagination:h}=s.data;this.allOrders=l,this.orders=l,this.pagination=h}).catch(s=>{this.$Swal.fire({icon:"error",title:s.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteOrder(a,s){this.$Swal.fire({title:"即將刪除訂單",text:`確定要刪除「${a}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#eb5a68",cancelButtonColor:"#8bafd7",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(l=>{l.isConfirmed&&this.$axios.delete(`${y}/api/${v}/admin/order/${s}`).then(h=>{this.$Swal.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:700}),this.getOrderList()}).catch(h=>{this.$Swal.fire({icon:"error",title:h.response.data.message})})})},orderSearch(){this.orders=this.ordersFilteredResults},formatDateString(a){return B(a).format("YYYY-MM-DD HH:mm:ss")},formatPrice(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},computed:{sortOrders(){return[...this.orders].sort((s,l)=>this.ascending?s[this.sortBy]-l[this.sortBy]:l[this.sortBy]-s[this.sortBy])},ordersFilteredResults(){return this.allOrders.filter(s=>String(s.create_at).toLowerCase().includes(this.searchInput.toLowerCase()))}},mounted(){this.getOrderList()},components:{CardPagination:C,Loading:x}},A={id:"app"},D={class:"card mt-lg-3 shadow-sm"},E={class:"navbar navbar-light bg-light"},R={class:"container-fluid"},N={class:"row g-2 align-items-center"},F={class:"col-auto"},q={class:"col-auto"},H={class:"card my-1 my-lg-4 shadow-sm"},M={class:"card-header"},U={class:"text-end py-2"},Y={class:"card-body"},G={class:"table table-hover"},j={class:"bg-light"},z={class:"align-middle"},$=t("span",{class:"bi bi-arrow-down-up ms-1"},null,-1),J=t("th",null,"訂購者",-1),K=t("th",null,"訂購商品",-1),Q=t("span",{class:"bi bi-arrow-down-up ms-1"},null,-1),W=t("th",null,"狀態",-1),X=t("th",null,"訂單成立時間",-1),Z=t("th",null,"操作",-1),tt={key:0},et=t("br",null,null,-1),st={key:0,class:"text-primary"},nt={key:1},ot={class:"btn-group"},it=["onClick"],rt={key:1},at=t("br",null,null,-1),lt={key:0,class:"text-primary"},dt={key:1},ct={class:"btn-group"},ut=["onClick"],_t={class:"card-footer d-flex justify-content-center"};function ht(a,s,l,h,i,d){const k=p("loading"),f=p("router-link"),w=p("CardPagination");return n(),o("div",A,[t("div",D,[t("nav",E,[t("div",R,[t("form",N,[t("div",F,[L(t("input",{class:"form-control",type:"search",placeholder:"搜尋訂單編號","aria-label":"Search","onUpdate:modelValue":s[0]||(s[0]=e=>i.searchInput=e)},null,512),[[S,i.searchInput]])]),t("div",q,[t("button",{class:"btn btn-outline-primary",type:"button",onClick:s[1]||(s[1]=(...e)=>d.orderSearch&&d.orderSearch(...e))},"搜尋 ")])])])])]),t("div",H,[t("div",M,[t("div",U,[t("button",{type:"button",class:"btn btn-primary text-white",onClick:s[2]||(s[2]=e=>i.ascending=!i.ascending)},r(i.ascending?"降冪":"升冪")+"排序 ",1)])]),t("div",Y,[t("table",G,[t("thead",j,[t("tr",z,[t("th",{onClick:s[3]||(s[3]=e=>i.sortBy="create_at")},[u("訂單編號 "),$]),J,K,t("th",{onClick:s[4]||(s[4]=e=>i.sortBy="total")},[u(" 金額 "),Q]),W,X,Z])]),i.sortBy==="default"?(n(),o("tbody",tt,[i.isLoading?(n(),P(k,{key:0,active:i.isLoading,"can-cancel":!1},null,8,["active"])):I("",!0),(n(!0),o(_,null,m(i.orders,e=>(n(),o("tr",{key:e.id},[t("td",null,r(e.create_at),1),t("td",null,r(e.user.name),1),t("td",null,[(n(!0),o(_,null,m(e.products,c=>(n(),o(_,{key:c.id},[u(r(c.product.title)+" x"+r(c.qty),1),et],64))),128))]),t("td",null," NT$"+r(d.formatPrice(e.total.toFixed(0))),1),t("td",null,[e.is_paid?(n(),o("span",st,"已付款")):(n(),o("span",nt,"未付款"))]),t("td",null,r(d.formatDateString(e.user.date)),1),t("td",null,[t("div",ot,[g(f,{class:"btn btn-outline-primary btn-sm",to:{name:"訂單詳細頁面",params:{id:e.id},query:{currentPage:i.pagination.current_page}}},{default:b(()=>[u(" 詳細 ")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>d.deleteOrder(e.create_at,e.id)}," 刪除 ",8,it)])])]))),128))])):(n(),o("tbody",rt,[(n(!0),o(_,null,m(d.sortOrders,e=>(n(),o("tr",{key:e.id},[t("td",null,r(e.create_at),1),t("td",null,r(e.user.name),1),t("td",null,[(n(!0),o(_,null,m(e.products,c=>(n(),o(_,{key:c.id},[u(r(c.product.title)+" x"+r(c.qty),1),at],64))),128))]),t("td",null," NT$"+r(e.total),1),t("td",null,[e.is_paid?(n(),o("span",lt,"已付款")):(n(),o("span",dt,"未付款"))]),t("td",null,r(d.formatDateString(e.user.date)),1),t("td",null,[t("div",ct,[g(f,{class:"btn btn-outline-primary btn-sm",to:{name:"訂單詳細頁面",params:{id:e.id},query:{currentPage:i.pagination.current_page}}},{default:b(()=>[u(" 詳細 ")]),_:2},1032,["to"]),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>d.deleteOrder(e.create_at,e.id)}," 刪除 ",8,ut)])])]))),128))]))])]),t("div",_t,[g(w,{pagination:i.pagination,onEmitGetlist:d.getOrderList},null,8,["pagination","onEmitGetlist"])])])])}const bt=O(V,[["render",ht]]);export{bt as default};
