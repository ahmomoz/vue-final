import{L as u}from"./index-T6W-CKt5.js";import{h as f}from"./moment-WSJ9un1t.js";import{_ as p,r as g,o as d,c,b as s,t as i,g as b,h as y,F as x,i as w}from"./index-OK89IDBn.js";var v={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"ahmomoz",BASE_URL:"/vue-final/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API_URL:l,VITE_APIPATH:m}=v,P={props:["id"],data(){return{order:{user:{}},isLoading:!0,currentPage:""}},methods:{getOrderList(a){this.isLoading=!0;const{id:e}=this.$route.params;this.$axios.get(`${l}/api/${m}/admin/orders?page=${a}`).then(n=>{const _=n.data.orders;this.order=_.find(t=>t.id.toLowerCase().includes(e.toLowerCase()))}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})}).finally(()=>{this.isLoading=!1})},goBack(){this.$router.push("/dashboard/orders")},togglePaymentStatus(){this.isLoading=!0,this.order.is_paid=!this.order.is_paid;const{id:a}=this.$route.params;this.$axios.put(`${l}/api/${m}/admin/order/${a}`,{data:this.order}).then(e=>{this.$Swal.fire({position:"top-end",icon:"success",title:"更新成功",showConfirmButton:!1,timer:700}),this.getOrderList(this.currentPage)}).catch(e=>{this.$Swal.fire({icon:"error",title:e.response.data.message})}).finally(()=>{this.isLoading=!1})},deleteOrder(){this.$Swal.fire({title:"即將刪除商品",text:`確定要刪除「${this.order.create_at}」嗎？`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#eb5a68",cancelButtonColor:"#8bafd7",confirmButtonText:"確定刪除",cancelButtonText:"取消"}).then(a=>{a.isConfirmed&&this.$axios.delete(`${l}/api/${m}/admin/order/${this.order.id}`).then(e=>{this.$Swal.fire({position:"top-end",icon:"success",title:"已刪除",showConfirmButton:!1,timer:700}),this.$router.push("/dashboard/orders")}).catch(e=>{this.$Swal.fire({icon:"error",title:e.response.data.message})})})},formatDateString(a){return f(a).format("YYYY-MM-DD HH:mm:ss")},formatPrice(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},created(){this.isLoading=!1,this.currentPage=this.$route.query.currentPage,this.getOrderList(this.currentPage)},components:{Loading:u}},k={class:"container"},L={class:"d-flex justify-content-between my-3"},S=s("h1",{class:"fs-3"},"訂單詳情",-1),B={class:"row rounded border-2 border-dashed-blue p-2"},C=s("dt",{class:"col-sm-3 text-truncate text-primary"},"訂單編號",-1),T={class:"col-sm-9 text-primary"},E=s("dt",{class:"col-sm-3 text-truncate text-primary"},"訂單金額",-1),O={class:"col-sm-9 text-primary"},A=s("dt",{class:"col-sm-3 text-truncate text-primary"},"訂單狀態",-1),D={key:0,class:"col-sm-9 text-primary"},I={key:1,class:"col-sm-9 text-primary"},V=s("dt",{class:"col-sm-3 text-truncate text-primary"},"發票狀態",-1),N=s("dd",{class:"col-sm-9 text-primary"},"未開立",-1),R={class:"row card mt-4 shadow-sm"},H=s("div",{class:"card-header"},[s("h5",{class:"my-1"},"購買商品")],-1),U={class:"card-body"},Y=["src"],$={class:"mx-2 my-auto"},F={class:"text-end mx-2 my-auto"},M={class:"card-footer"},q={class:"text-end fs-5 m-0"},j={class:"row card mt-4 shadow-sm"},z=s("div",{class:"card-header"},[s("h5",{class:"my-1"},"收件人資訊")],-1),G={class:"card-body"},J={class:"mb-3"},K=s("label",{for:"name",class:"form-label fw-bold"},"姓名",-1),Q={class:"fs-5"},W={class:"mb-3"},X=s("label",{for:"tel",class:"form-label fw-bold"},"電話",-1),Z={class:"fs-5"},ss={class:"mb-3"},ts=s("label",{for:"address",class:"form-label fw-bold"},"地址",-1),es={class:"fs-5"},os={class:"mb-3"},rs=s("label",{for:"email",class:"form-label fw-bold"},"E-mail",-1),is={class:"fs-5"},as={class:"mb-3"},ds=s("label",{for:"message",class:"form-label fw-bold"},"備註",-1),cs={key:0,class:"fs-5"},ns={key:1,class:"fs-5"},ls={class:"mb-3"},ms=s("label",{for:"message",class:"form-label fw-bold"},"訂單成立時間",-1),_s={class:"fs-5"},hs={class:"text-end mt-3 mb-5"};function us(a,e,n,_,t,r){const h=g("loading");return d(),c("div",k,[s("div",L,[S,t.order.is_paid?(d(),c("button",{key:0,type:"button",class:"btn btn-primary text-light",onClick:e[0]||(e[0]=(...o)=>r.togglePaymentStatus&&r.togglePaymentStatus(...o))}," 切換成未付款 ")):(d(),c("button",{key:1,type:"button",class:"btn btn-primary text-light",onClick:e[1]||(e[1]=(...o)=>r.togglePaymentStatus&&r.togglePaymentStatus(...o))}," 切換成已付款 "))]),s("dl",B,[C,s("dd",T,i(t.order.create_at),1),E,s("dd",O,"NT $"+i(r.formatPrice(t.order.total)),1),A,t.order.is_paid?(d(),c("dd",D,"訂單已付款完成")):(d(),c("dd",I,"訂單尚未付款")),V,N]),s("div",R,[H,s("div",U,[t.isLoading?(d(),b(h,{key:0,active:t.isLoading,"can-cancel":!1},null,8,["active"])):y("",!0),(d(!0),c(x,null,w(t.order.products,o=>(d(),c("div",{key:o.product.id,class:"d-flex align-items-center m-2"},[s("img",{src:o.product.imagesUrl[0],alt:"商品圖片",style:{width:"100px"}},null,8,Y),s("p",$,i(o.product.title)+" x "+i(o.qty),1),s("p",F," NT$ "+i(r.formatPrice(o.product.price)),1)]))),128))]),s("div",M,[s("p",q,"總金額 NT$ "+i(r.formatPrice(t.order.total.toFixed(0))),1)])]),s("div",j,[z,s("div",G,[s("div",J,[K,s("p",Q,i(t.order.user.name),1)]),s("div",W,[X,s("p",Z,i(t.order.user.tel),1)]),s("div",ss,[ts,s("p",es,i(t.order.user.address),1)]),s("div",os,[rs,s("p",is,i(t.order.user.email),1)]),s("div",as,[ds,t.order.user.message?(d(),c("p",cs,i(t.order.user.message),1)):(d(),c("p",ns,"無填寫備註"))]),s("div",ls,[ms,s("p",_s,i(r.formatDateString(t.order.user.date)),1)])])]),s("div",hs,[s("button",{type:"button",class:"btn btn-outline-secondary mx-2",onClick:e[2]||(e[2]=(...o)=>r.goBack&&r.goBack(...o))}," 返回前頁 "),s("button",{type:"button",class:"btn btn-danger text-light",onClick:e[3]||(e[3]=(...o)=>r.deleteOrder&&r.deleteOrder(...o))}," 刪除訂單 ")])])}const bs=p(P,[["render",us]]);export{bs as default};
